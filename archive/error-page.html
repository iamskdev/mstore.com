<div class="error-handler-container">
  <!-- Inline Error Display (for specific components) -->
  <div class="inline-error hidden" id="inlineError">
    <div class="error-content">
      <i class="fas fa-exclamation-triangle error-icon"></i>
      <div class="error-text">
        <h4 class="error-title" id="inlineErrorTitle">Error</h4>
        <p class="error-message" id="inlineErrorMessage"></p>
      </div>
      <button class="error-action" id="inlineErrorRetry">Retry</button>
      <button class="error-details-toggle" id="inlineErrorDetailsToggle">
        <i class="fas fa-chevron-down"></i>
      </button>
    </div>
    <div class="error-details hidden" id="inlineErrorDetails"></div>
  </div>

  <!-- Console Error Monitor (floating button) -->
  <div class="console-monitor" id="consoleMonitor">
    <div class="console-badge hidden" id="consoleBadge">0</div>
    <button class="console-button" id="consoleButton">
      <i class="fas fa-terminal"></i>
    </button>
    <div class="console-panel hidden" id="consolePanel">
      <div class="console-header">
        <h4>Error Console</h4>
        <button class="clear-console" id="clearConsole">Clear</button>
      </div>
      <div class="console-list" id="consoleList"></div>
    </div>
  </div>
</div>

<style>
  /* Base Styles */
  .error-handler-container {
    --error-color: #d32f2f;
    --warning-color: #ffa000;
    --info-color: #1976d2;
    --success-color: #388e3c;
    --bg-color: #ffffff;
    --text-color: #212121;
    --border-color: #e0e0e0;
    --shadow: 0 2px 10px rgba(0,0,0,0.1);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    font-size: 14px;
  }

  /* Inline Error Styles */
  .inline-error {
    border: 1px solid var(--error-color);
    border-radius: 6px;
    background-color: rgba(211, 47, 47, 0.05);
    margin: 10px 0;
    overflow: hidden;
  }

  .error-content {
    display: flex;
    align-items: center;
    padding: 12px;
    gap: 12px;
  }

  .error-icon {
    color: var(--error-color);
    font-size: 20px;
  }

  .error-text {
    flex: 1;
  }

  .error-title {
    color: var(--error-color);
    margin: 0 0 4px 0;
    font-size: 1.1em;
  }

  .error-message {
    color: var(--text-color);
    margin: 0;
  }

  .error-action {
    background: var(--error-color);
    color: white;
    border: none;
    border-radius: 4px;
    padding: 6px 12px;
    cursor: pointer;
    font-weight: 500;
  }

  .error-details-toggle {
    background: none;
    border: none;
    color: var(--text-color);
    cursor: pointer;
    font-size: 16px;
  }

  .error-details {
    background: var(--bg-color);
    border-top: 1px solid var(--border-color);
    padding: 12px;
    font-family: monospace;
    font-size: 12px;
    white-space: pre-wrap;
    max-height: 200px;
    overflow-y: auto;
  }

  /* Console Monitor Styles */
  .console-monitor {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 9999;
  }

  .console-button {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: var(--error-color);
    color: white;
    border: none;
    cursor: pointer;
    font-size: 20px;
    box-shadow: var(--shadow);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .console-badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background: #ff5722;
    color: white;
    border-radius: 50%;
    width: 22px;
    height: 22px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: bold;
  }

  .console-panel {
    position: absolute;
    bottom: 60px;
    right: 0;
    width: 300px;
    max-height: 400px;
    background: var(--bg-color);
    border-radius: 8px;
    box-shadow: var(--shadow);
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  .console-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px;
    background: #f5f5f5;
    border-bottom: 1px solid var(--border-color);
  }

  .console-header h4 {
    margin: 0;
    color: var(--text-color);
  }

  .clear-console {
    background: none;
    border: none;
    color: var(--error-color);
    cursor: pointer;
    font-weight: 500;
  }

  .console-list {
    flex: 1;
    overflow-y: auto;
    padding: 8px;
  }

  .console-item {
    padding: 8px;
    margin-bottom: 8px;
    border-radius: 4px;
    font-size: 12px;
    word-break: break-word;
  }

  .console-item.error {
    background: rgba(211, 47, 47, 0.1);
    border-left: 3px solid var(--error-color);
  }

  .console-item.warning {
    background: rgba(255, 160, 0, 0.1);
    border-left: 3px solid var(--warning-color);
  }

  .hidden {
    display: none;
  }
</style>

<script>
  class ErrorHandler {
    constructor() {
      // Inline error elements
      this.inlineError = document.getElementById('inlineError');
      this.inlineErrorTitle = document.getElementById('inlineErrorTitle');
      this.inlineErrorMessage = document.getElementById('inlineErrorMessage');
      this.inlineErrorDetails = document.getElementById('inlineErrorDetails');
      this.inlineErrorRetry = document.getElementById('inlineErrorRetry');
      this.inlineErrorDetailsToggle = document.getElementById('inlineErrorDetailsToggle');
      
      // Console monitor elements
      this.consoleMonitor = document.getElementById('consoleMonitor');
      this.consoleBadge = document.getElementById('consoleBadge');
      this.consoleButton = document.getElementById('consoleButton');
      this.consolePanel = document.getElementById('consolePanel');
      this.clearConsole = document.getElementById('clearConsole');
      this.consoleList = document.getElementById('consoleList');
      
      // State
      this.errorCount = 0;
      this.retryCallback = null;
      this.originalConsole = {
        log: console.log,
        error: console.error,
        warn: console.warn,
        info: console.info
      };
      
      this.init();
    }
    
    init() {
      // Inline error event listeners
      this.inlineErrorRetry.addEventListener('click', () => {
        this.hideInlineError();
        if (this.retryCallback) this.retryCallback();
      });
      
      this.inlineErrorDetailsToggle.addEventListener('click', () => {
        this.inlineErrorDetails.classList.toggle('hidden');
        const icon = this.inlineErrorDetailsToggle.querySelector('i');
        if (this.inlineErrorDetails.classList.contains('hidden')) {
          icon.classList.remove('fa-chevron-up');
          icon.classList.add('fa-chevron-down');
        } else {
          icon.classList.remove('fa-chevron-down');
          icon.classList.add('fa-chevron-up');
        }
      });
      
      // Console monitor event listeners
      this.consoleButton.addEventListener('click', () => {
        this.consolePanel.classList.toggle('hidden');
      });
      
      this.clearConsole.addEventListener('click', () => {
        this.consoleList.innerHTML = '';
        this.errorCount = 0;
        this.updateConsoleBadge();
      });
      
      // Override console methods
      this.overrideConsole();
    }
    
    // Public API
    
    showInlineError(error, retryCallback = null) {
      this.retryCallback = retryCallback;
      
      // Set error title based on type
      if (error instanceof TypeError) {
        this.inlineErrorTitle.textContent = 'Type Error';
      } else if (error instanceof ReferenceError) {
        this.inlineErrorTitle.textContent = 'Reference Error';
      } else if (error instanceof Error) {
        this.inlineErrorTitle.textContent = 'Error';
      } else {
        this.inlineErrorTitle.textContent = 'Operation Failed';
      }
      
      // Set error message
      this.inlineErrorMessage.textContent = this.getErrorMessage(error);
      
      // Set error details
      this.inlineErrorDetails.textContent = this.getErrorDetails(error);
      
      // Show the error
      this.inlineError.classList.remove('hidden');
    }
    
    hideInlineError() {
      this.inlineError.classList.add('hidden');
      this.inlineErrorDetails.classList.add('hidden');
    }
    
    // Console error handling
    
    overrideConsole() {
      const self = this;
      
      console.error = function() {
        self.originalConsole.error.apply(console, arguments);
        self.addConsoleItem('error', arguments);
      };
      
      console.warn = function() {
        self.originalConsole.warn.apply(console, arguments);
        self.addConsoleItem('warning', arguments);
      };
      
      console.log = function() {
        self.originalConsole.log.apply(console, arguments);
      };
      
      console.info = function() {
        self.originalConsole.info.apply(console, arguments);
      };
      
      // Catch uncaught errors
      window.onerror = function(message, source, lineno, colno, error) {
        self.addConsoleItem('error', [message, source, `Line ${lineno}:${colno}`]);
      };
      
      // Catch unhandled promise rejections
      window.addEventListener('unhandledrejection', function(event) {
        self.addConsoleItem('error', ['Unhandled Promise Rejection:', event.reason]);
      });
    }
    
    addConsoleItem(type, args) {
      if (type === 'error') {
        this.errorCount++;
        this.updateConsoleBadge();
      }
      
      const item = document.createElement('div');
      item.className = `console-item ${type}`;
      
      // Convert arguments to readable string
      let content = '';
      for (let arg of args) {
        if (typeof arg === 'object' && arg !== null) {
          try {
            content += JSON.stringify(arg, null, 2) + '\n';
          } catch (e) {
            content += String(arg) + '\n';
          }
        } else {
          content += String(arg) + '\n';
        }
      }
      
      item.textContent = content.trim();
      this.consoleList.appendChild(item);
      this.consoleList.scrollTop = this.consoleList.scrollHeight;
    }
    
    updateConsoleBadge() {
      if (this.errorCount > 0) {
        this.consoleBadge.textContent = this.errorCount;
        this.consoleBadge.classList.remove('hidden');
      } else {
        this.consoleBadge.classList.add('hidden');
      }
    }
    
    // Helper methods
    
    getErrorMessage(error) {
      if (error instanceof Error) {
        return error.message;
      } else if (typeof error === 'string') {
        return error;
      } else if (error?.message) {
        return error.message;
      } else {
        return 'An unknown error occurred';
      }
    }
    
    getErrorDetails(error) {
      if (error instanceof Error) {
        return `Error: ${error.message}\n\nStack Trace:\n${error.stack || 'No stack trace available'}`;
      } else if (typeof error === 'object') {
        try {
          return JSON.stringify(error, null, 2);
        } catch (e) {
          return String(error);
        }
      }
      return String(error);
    }
  }

  // Initialize when DOM is loaded
  document.addEventListener('DOMContentLoaded', () => {
    window.errorHandler = new ErrorHandler();
  });
</script>