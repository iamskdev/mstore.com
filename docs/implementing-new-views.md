> **DOCUMENT AUDIT**
> - **Status:** `Updated`
> - **Last Reviewed:** 24/08/2025 18:58:34 +05:30
> - **Reviewer:** Santosh (with Gemini)
> - **Purpose:** This document provides a mandatory guide for developers on how to create new pages and views within the "mStore" project, ensuring consistency, performance, and adherence to the established architecture. It has been updated to reflect the latest routeManager architecture and best practices.

---

# ЁЯУЦ How to Implement New Pages and Views (рдирдП рдкреЗрдЬ рдФрд░ рд╡реНрдпреВ рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд░реЗрдВ)

рдпрд╣ рдЧрд╛рдЗрдб "mStore" рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ рдПрдХ рдирдпрд╛ рдкреЗрдЬ рдпрд╛ рд╡реНрдпреВ рдмрдирд╛рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рд╡рд┐рд╡рд░рдг рджреЗрддрд╛ рд╣реИред рдПрдХ рд╕реБрд╕рдВрдЧрдд рдФрд░ рд░рдЦрд░рдЦрд╛рд╡ рдпреЛрдЧреНрдп рдХреЛрдбрдмреЗрд╕ рдмрдирд╛рдП рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЗрди рдЪрд░рдгреЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдирд╛ рдЕрдирд┐рд╡рд╛рд░реНрдп рд╣реИред

## ЁЯОп рдореБрдЦреНрдп рд╕рд┐рджреНрдзрд╛рдВрдд (Core Principles)

1.  **рдореЙрдбреНрдпреВрд▓рд░рд┐рдЯреА (Modularity):** рдкреНрд░рддреНрдпреЗрдХ рдкреЗрдЬ рдХреЛ рдПрдХ рдЖрддреНрдордирд┐рд░реНрднрд░ рдореЙрдбреНрдпреВрд▓ рдХреЗ рд░реВрдк рдореЗрдВ рдорд╛рдирд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬрд┐рд╕рдХреА рдЕрдкрдиреА HTML, CSS, рдФрд░ JS рдлрд╛рдЗрд▓реЗрдВ рд╣реЛрдВред
2.  **рдХреЗрдВрджреНрд░реАрдХреГрдд рд╕реНрдЯреЗрдЯ рдореИрдиреЗрдЬрдореЗрдВрдЯ (Centralized State Management):** рд╕рднреА рд╡реНрдпреВ рдЯреНрд░рд╛рдВрдЬрд╝рд┐рд╢рди рдФрд░ рднреВрдорд┐рдХрд╛ рдкрд░рд┐рд╡рд░реНрддрди рдХреЛ **`routeManager`** рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред `routeManager` рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ рд╡реНрдпреВ `div` рддрддреНрд╡реЛрдВ рдХреЛ рдмрдирд╛рддрд╛ рд╣реИ рдФрд░ рдЙрдирдХреЗ рд╕рдВрдмрдВрдзрд┐рдд HTML, CSS, рдФрд░ JS рдХреЛ рд▓реЛрдб рдХрд░рддрд╛ рд╣реИред рд╕реАрдзреЗ DOM рдореЗрдВ рд╣реЗрд░рдлреЗрд░ рдХрд░рдХреЗ рд╡реНрдпреВ рдХреЛ рди рджрд┐рдЦрд╛рдПрдБ рдпрд╛ рдЫрд┐рдкрд╛рдПрдБред
3.  **рдбреЗрдЯрд╛ рдПрдмреНрд╕реНрдЯреНрд░реИрдХреНрд╢рди (Data Abstraction):** рдлрд╛рдпрд░рд╕реНрдЯреЛрд░ рд╕реЗ рд╕реАрдзреЗ рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп рд╣рдореЗрд╢рд╛ **`data-manager.js`** рдореЗрдВ рдореМрдЬреВрдж рдлрдВрдХреНрд╢рдиреНрд╕ (рдЬреИрд╕реЗ `fetchItemById`, `fetchAllUsers`) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдРрдк `firebase`, `emulator`, рдпрд╛ `localstore` рдбреЗрдЯрд╛ рд╕реНрд░реЛрддреЛрдВ рдХреЗ рдмреАрдЪ рдЖрд╕рд╛рдиреА рд╕реЗ рд╕реНрд╡рд┐рдЪ рдХрд░ рд╕рдХреЗред
4.  **рдкреБрди: рдкреНрд░рдпреЛрдЬреНрдпрддрд╛ (Reusability):** рдирдП рдХрдВрдкреЛрдиреЗрдВрдЯреНрд╕ рдмрдирд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рджреЗрдЦреЗрдВ рдХрд┐ рдХреНрдпрд╛ `/source/components/` рдореЗрдВ рдХреЛрдИ рдореМрдЬреВрджрд╛ рдХрдВрдкonent (рдЬреИрд╕реЗ `card.js`) рдЖрдкрдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЛ рдкреВрд░рд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

---

## ЁЯЪА рдПрдХ рдирдпрд╛ рдкреЗрдЬ рдмрдирд╛рдиреЗ рдХреЗ рдЪрд░рдг (Steps to Create a New Page)

рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ рд╣рдо рдПрдХ рд╡реНрдпрд╛рдкрд╛рд░реА рдХреЗ рд▓рд┐рдП рдПрдХ рдирдпрд╛ "рдкреНрд░реЛрдлрд╛рдЗрд▓ рдПрдбрд┐рдЯ" рдкреЗрдЬ рдмрдирд╛ рд░рд╣реЗ рд╣реИрдВред

### рдЪрд░рдг 1: рдлрд╝рд╛рдЗрд▓ рд╕рдВрд░рдЪрдирд╛ (File Structure)

рд╕рд╣реА рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдореЗрдВ рдЖрд╡рд╢реНрдпрдХ рдлрд╛рдЗрд▓реЗрдВ рдмрдирд╛рдПрдБред

```
/source/
тФФтФАтФА modules/
    тФФтФАтФА merchant/
        тФЬтФАтФА pages/
        тФВ   тФФтФАтФА merchant-profile-edit.html  <-- (рдирдИ HTML)
        тФЬтФАтФА scripts/
        тФВ   тФФтФАтФА merchant-profile-edit.js    <-- (рдирдИ JS)
        тФФтФАтФА styles/
            тФФтФАтФА merchant-profile-edit.css   <-- (рдирдИ CSS)
```

### рдЪрд░рдг 2: рд╡реНрдпреВ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ (`view-config.js`)

`source/routes.js` рдЦреЛрд▓реЗрдВ рдФрд░ `routeConfig` рдСрдмреНрдЬреЗрдХреНрдЯ рдореЗрдВ рдЕрдкрдиреЗ рдирдП рд╡реНрдпреВ рдХреЗ рд▓рд┐рдП рдПрдХ рдПрдВрдЯреНрд░реА рдЬреЛрдбрд╝реЗрдВред

```javascript
const routeConfig = {
    // ... other roles
    merchant: {
        // ... other merchant views
        'profile-edit': { // <-- рдирдпрд╛ рд╡реНрдпреВ
            id: 'merchant-profile-edit-view', // рдпрд╣ ID рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ рдмрдирд╛рдП рдЧрдП div рдХреЛ рджреА рдЬрд╛рдПрдЧреА
            path: './source/modules/merchant/pages/merchant-profile-edit.html',
            // JS рдФрд░ CSS рдкрде рд╡реИрдХрд▓реНрдкрд┐рдХ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЕрдиреБрд╢рдВрд╕рд┐рдд рд╣реИрдВ
            jsPath: './source/modules/merchant/scripts/merchant-profile-edit.js',
            cssPath: './source/modules/merchant/styles/merchant-profile-edit.css',
            embedFooter: false, // рдЗрд╕ рдкреЗрдЬ рдкрд░ рдлреБрдЯрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ
            showFilterBar: false, // рдЗрд╕ рдкреЗрдЬ рдкрд░ рдлрд┐рд▓реНрдЯрд░ рдмрд╛рд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ
            title: 'рдкреНрд░реЛрдлрд╛рдЗрд▓ рдПрдбрд┐рдЯ' // рдкреЗрдЬ рдХрд╛ рд╢реАрд░реНрд╖рдХ
        },
        'dynamic-content-example': { // рдПрдХ рдЙрджрд╛рд╣рд░рдг рдЬрд╣рд╛рдВ HTML рд╕реАрдзреЗ рд▓реЛрдб рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ
            id: 'dynamic-content-view',
            path: null, // HTML рдлрд╝рд╛рдЗрд▓ рд▓реЛрдб рдирд╣реАрдВ рдХреА рдЬрд╛рдПрдЧреА
            jsPath: './source/modules/consumer/scripts/dynamic-content.js', // JS рдЕрднреА рднреА рд▓реЛрдб рд╣реЛрдЧрд╛
            embedFooter: true, // рдлреБрдЯрд░ рдХреЛ рдПрдореНрдмреЗрдб рдХрд░реЗрдВ
            title: 'рдбрд╛рдпрдирд╛рдорд┐рдХ рдХрдВрдЯреЗрдВрдЯ'
        }
    }
    // ... other roles
};
```
**рдиреЛрдЯ:**
*   `path: null` рдХрд╛ рдЙрдкрдпреЛрдЧ рдЙрди рд╡реНрдпреВ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рд╕реАрдзреЗ HTML рдлрд╝рд╛рдЗрд▓ рд╕реЗ рдХрдВрдЯреЗрдВрдЯ рд▓реЛрдб рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ (рдЬреИрд╕реЗ рдХрд┐ рд╡реЗ рдЬреЛ JavaScript рдореЗрдВ рдЕрдкрдирд╛ UI рдмрдирд╛рддреЗ рд╣реИрдВ рдпрд╛ рдХреЗрд╡рд▓ рдПрдХ рдкреНрд▓реЗрд╕рд╣реЛрд▓реНрдбрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддреЗ рд╣реИрдВ)ред
*   `embedFooter: true` рдФрд░ `showFilterBar: true` рдЧреБрдг `routeManager` рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдХрдВрдкреЛрдиреЗрдВрдЯреНрд╕ рдХреЛ рд╡реНрдпреВ рдореЗрдВ рдПрдореНрдмреЗрдб рдХрд░рдиреЗ рдХрд╛ рдирд┐рд░реНрджреЗрд╢ рджреЗрддреЗ рд╣реИрдВред

### рдЪрд░рдг 3: рдкреЗрдЬ рдХрд╛ рд▓реЙрдЬрд┐рдХ рд▓рд┐рдЦреЗрдВ (JS рдлрд╛рдЗрд▓)

рдЕрдкрдиреА рдирдИ `.js` рдлрд╝рд╛рдЗрд▓ (`merchant-profile-edit.js`) рдореЗрдВ, рдПрдХ `export function init()` рдлрд╝рдВрдХреНрд╢рди рдмрдирд╛рдПрдБред `routeManager` рдЗрд╕ `init()` рдлрд╝рдВрдХреНрд╢рди рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдХреЙрд▓ рдХрд░реЗрдЧрд╛ рдЬрдм рдЖрдкрдХрд╛ рдкреЗрдЬ рдкрд╣рд▓реА рдмрд╛рд░ рд▓реЛрдб рд╣реЛрдЧрд╛ред

```javascript
import { fetchMerchantById } from '../../firebase/firestore/merchants.js'; // рд╕рд╣реА рдкрде рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ
import { showToast } from '../../utils/toast.js';

export function init() {
    const view = document.getElementById('merchant-profile-edit-view');
    if (!view || view.dataset.initialized) return; // рджреЛрдмрд╛рд░рд╛ рд╢реБрд░реВ рд╣реЛрдиреЗ рд╕реЗ рд░реЛрдХреЗрдВ

    console.log('Initializing Merchant Profile Edit page...');

    // рдпрд╣рд╛рдБ рдЕрдкрдирд╛ рд▓реЙрдЬрд┐рдХ рд▓рд┐рдЦреЗрдВ:
    // 1. DOM рдПрд▓рд┐рдореЗрдВрдЯреНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ (рдЬреИрд╕реЗ, рдлреЙрд░реНрдо, рдЗрдирдкреБрдЯ)
    // 2. data-manager.js рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрд╡рд╢реНрдпрдХ рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
    //    рдЙрджрд╛рд╣рд░рдг: fetchMerchantById(someMerchantId).then(data => { /* ... */ });
    // 3. рдЗрд╡реЗрдВрдЯ рд▓рд┐рд╕рдирд░реНрд╕ рдЬреЛрдбрд╝реЗрдВ (рдЬреИрд╕реЗ, 'submit' рдпрд╛ 'click')

    view.dataset.initialized = 'true';
}
```
**рдорд╣рддреНрд╡рдкреВрд░реНрдг:** рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдЖрдкрдХреЗ JS рдореЙрдбреНрдпреВрд▓ рдореЗрдВ `export function init()` рд╣реИред `routeManager` рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдЖрдкрдХреЗ рд╡реНрдпреВ рдХреЗ рд▓рд┐рдП рдПрдВрдЯреНрд░реА рдкреЙрдЗрдВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред

### рдЪрд░рдг 4: рдиреЗрд╡рд┐рдЧреЗрд╢рди рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдВ

рдХрд┐рд╕реА рдЕрдиреНрдп рдкреЗрдЬ (рдЬреИрд╕реЗ, `merchant-account.html`) рд╕реЗ, рдЖрдк рдПрдХ рдмрдЯрди рдпрд╛ рд▓рд┐рдВрдХ рдкрд░ рдПрдХ рдЗрд╡реЗрдВрдЯ рд▓рд┐рд╕рдирд░ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ `routeManager` рдХреЛ рдЖрдкрдХреЗ рдирдП рдкреЗрдЬ рдкрд░ рд╕реНрд╡рд┐рдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣реЗрдЧрд╛ред

```javascript
// рдЙрджрд╛рд╣рд░рдг: merchant-account.js рдореЗрдВ
const editProfileBtn = document.getElementById('edit-profile-btn');
editProfileBtn.addEventListener('click', () => {
    // рд╕реАрдзреЗ window.routeManager рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВ
    window.routeManager.switchView('merchant', 'profile-edit');
});
```

---

## тЬЕ рдЪреЗрдХрд▓рд┐рд╕реНрдЯ рдФрд░ рд╕рд░реНрд╡реЛрддреНрддрдо рдкреНрд░рдерд╛рдПрдБ

-   **рдХреНрдпрд╛ рдЖрдкрдиреЗ `view-config.js` рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд┐рдпрд╛ рд╣реИ?** рдпрд╣ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдХрджрдо рд╣реИред
-   **рдХреНрдпрд╛ рдЖрдкрдХрд╛ рд╕рд╛рд░рд╛ рд▓реЙрдЬрд┐рдХ рдПрдХ `export function init()` рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдЕрдВрджрд░ рд╣реИ?** рдпрд╣ рд▓реЗрдЬрд╝реА-рд▓реЛрдбрд┐рдВрдЧ рдФрд░ `routeManager` рджреНрд╡рд╛рд░рд╛ рд╕рд╣реА рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИред
-   **рдХреНрдпрд╛ рдЖрдк рдбреЗрдЯрд╛ рдХреЗ рд▓рд┐рдП `data-manager.js` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ?** рдпрд╣ рдбреЗрдЯрд╛ рд╕реНрд░реЛрдд рдПрдмреНрд╕реНрдЯреНрд░реИрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред
-   **рдХреНрдпрд╛ рдЖрдк рдлреАрдбрдмреИрдХ рдХреЗ рд▓рд┐рдП `showToast()` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ?**
-   **рдХреНрдпрд╛ рдЖрдкрдиреЗ рдЕрдкрдиреЗ рдкреЗрдЬ рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рдПрдХ `data-initialized` рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ рд╕реЗрдЯ рдХрд┐рдпрд╛ рд╣реИ** рддрд╛рдХрд┐ рд▓реЙрдЬрд┐рдХ рджреЛрдмрд╛рд░рд╛ рди рдЪрд▓реЗ?
-   **рдЖрдкрдХреЛ рдЕрдм `index.html` рдореЗрдВ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ `div` рдЬреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ!** `routeManager` рдЗрд╕реЗ рдЖрдкрдХреЗ рд▓рд┐рдП рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ рдмрдирд╛рддрд╛ рд╣реИред
-   **рдХреНрдпрд╛ рдЖрдкрдиреЗ `view-config.js` рдореЗрдВ `embedFooter` рдФрд░ `showFilterBar` рдЧреБрдгреЛрдВ рдХреЛ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рд╕реЗрдЯ рдХрд┐рдпрд╛ рд╣реИ?** `routeManager` рдЗрди рдЧреБрдгреЛрдВ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдлреБрдЯрд░ рдФрд░ рдлрд┐рд▓реНрдЯрд░ рдмрд╛рд░ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдПрдореНрдмреЗрдб рдХрд░реЗрдЧрд╛ред
