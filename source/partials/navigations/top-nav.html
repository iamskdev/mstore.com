<style>
    .top-navigation {
      height: var(--top-height);
      background: var(--bg-primary);
      display: flex;
      align-items: center;
      padding: 0 12px; 
      box-shadow: 0 1px 0 0 var(--border-color); 
      top: 0;
      left: 0; 
      right: 0; 
      position: fixed;
    }
    /* New classes for header toggle items */
    .header-toggle-item {
      display: flex; /* Default to flex */
    }
    .header-toggle-item.hidden {
      display: none !important; /* This will override the default flex */
    }

    /* --- FINAL & SIMPLIFIED FIX for Search/Branding Bug --- */

    /* When search is active, hide all branding items and standard action icons. */
    .top-navigation.search-active .header-toggle-item,
    .top-navigation.search-active .brand-name,
    /* .top-navigation.search-active #view-back-btn,  <-- This rule is no longer needed, JS will handle visibility */
    .top-navigation.search-active #search-toggle,
    .top-navigation.search-active #connection-indicator,
    .top-navigation.search-active #notification-icon,
    .top-navigation.search-active #settings-icon {
      display: none;
    }

    .header-branding {
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 0;
    }

    .brand-logo {
      width: 32px;
      height: 32px;
      border-radius: 50%; /* ALWAYS a circle to prevent shape-shifting flash */
      background-color: transparent;
      border: 1px solid transparent; /* Placeholder border to prevent layout shift */
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      flex-shrink: 0;
      cursor: pointer; /* Make only the logo clickable */
      transition: all 0.2s ease-in-out;
    }

    /* NEW: A placeholder style for when an avatar is being fetched. */
    /* This prevents a "square-to-circle" flash. */
    .brand-logo.is-loading-avatar {
      background-color: var(--bg-tertiary);
      animation: pulse-bg 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      border-color: var(--border-color); /* Make border visible during load */
    }
    @keyframes pulse-bg {
      0%, 100% { background-color: var(--bg-tertiary); }
      50% { background-color: var(--bg-hover); }
    }

    /* This class is added by JS only when a user/merchant avatar is loaded */
    .brand-logo.is-avatar {
      background-color: var(--bg-tertiary);
      border-color: var(--border-color); /* Make border visible for avatars */
    }

    .brand-logo img {
      width: 100%;
      height: 100%;
      object-fit: contain; /* Use 'contain' for app logo to prevent cropping */
    }

    .brand-logo.is-avatar img {
      object-fit: cover; /* Use 'cover' for avatars to fill the circle */
    }

    .brand-name {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--text-primary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .header-actions {
      display: flex;
      gap: 20px; /* Increased gap for better spacing */
      align-items: center; /* This will vertically align the icons */
      margin-left: auto;
    }

    .header-icon, .pwa-install-button {
      font-size: 1.2rem;
      color: var(--text-secondary); /* आइकन के लिए डिफ़ॉल्ट रंग */
      cursor: pointer;
      position: relative;
    }

    /* Flip the search icon to face right */
    #search-toggle i {
      transform: scaleX(-1); /* Target the icon inside the wrapper */
    }

    #search-back {
      display: none; /* Hidden by default */
      margin-right: 8px;
    }
    .top-navigation.search-active #search-back {
      display: none; /* This element is removed, rule is obsolete */
    }
    .header-search-input-container {
      display: none; /* FIX: Hide search container by default */
      flex: 1;
      position: relative;
    }
    .header-search-input {
      width: 100%;
      padding: 10px 36px 10px 12px;
      border: 1px solid var(--border-color);
      border-radius: 24px;
      background: var(--bg-tertiary);
      font-size: 0.95rem;
      outline: none;
      box-sizing: border-box;
      color: var(--text-primary);
    }

    .top-navigation.search-active .header-search-input-container {
      display: block; /* Visible in search mode */
    }

    /* New styles for notification view */
    .notification-header-content {
      display: none; /* Hidden by default */
      align-items: center;
      gap: 12px;
    }

    .top-navigation.notification-active .header-branding,
    .top-navigation.notification-active .header-actions,
    .top-navigation.notification-active .header-search-input-container {
      display: none;
    }

    .top-navigation.notification-active .notification-header-content {
      display: flex; /* Show notification header content */
    }

    .search-clear {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-tertiary);
      display: none;
      cursor: pointer;
    }

    #notification-icon .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: var(--header-badge-bg);
      color: var(--header-badge-text);
      border-radius: 50%;
      width: 16px;
      height: 16px;
      font-size: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }


    /* Special style for the badge when used as a storefront/system indicator */
    #notification-icon .notification-badge.storefront-indicator {
      background: var(--header-banner-promo-bg); /* Use promo banner color for consistency */
    }
    /* New style for dev mode indicator */
    #notification-icon .notification-badge.dev-indicator {
      background: var(--header-banner-dev-bg); /* Use dev banner color for consistency */
      color: var(--header-banner-dev-text);
      font-weight: bold;
    }

    .hidden { display: none !important; }
    .visible { display: flex !important; }

    @keyframes bellShake {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(15deg); }
      50% { transform: rotate(-15deg); }
      75% { transform: rotate(5deg); }
    }

    .bell-shake { animation: bellShake 0.5s ease-in-out; }

    #notification-icon.active-notification i {
      color: var(--accent-primary); /* Highlight color for active notification icon */
    }

    /* Ripple Effect for Notification Icon */
    #notification-icon .ripple {
      position: absolute;
      border-radius: 50%;
      background: rgba(var(--accent-primary-rgb), 0.1); /* Use global variable directly */
      transform: scale(0);
      animation: ripple 0.6s linear;
      pointer-events: none;
      z-index: 1;
    }

    @keyframes ripple {
      to {
        transform: scale(1.5);
        opacity: 0;
      }
    }

    /* Connection Status Indicator */
    .connection-indicator {
      position: relative;
    }

    .connection-indicator i {
      transition: all 0.3s ease;
    }

    .connection-indicator.online i {
      color: var(--accent-success, #22c55e);
    }

    .connection-indicator.offline i {
      color: var(--accent-danger, #ef4444);
      animation: pulse-offline 2s infinite;
    }

    .connection-indicator.weak i {
      color: var(--accent-warning, #f59e0b);
      animation: pulse-weak 3s infinite;
    }

    @keyframes pulse-offline {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    @keyframes pulse-weak {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(0.9); }
    }
  </style>
  <nav id="top-nav" class="top-navigation">
      <!-- Universal Back Button (Initially Hidden) -->
      <i class="fas fa-arrow-left header-icon hidden" id="view-back-btn" style="font-size: 1.2rem; cursor: pointer; margin-right: 12px;"></i>
      <div class="header-branding">
      <i class="fas fa-bars header-icon header-toggle-item menu-icon" id="header-menu-icon" style="font-size: 1.4rem; cursor: pointer; margin-right: 4px;" data-header-item="menu"></i>
      <span class="brand-logo header-toggle-item logo-container" id="header-logo-container" data-header-item="logo">
                <img src="./source/assets/logos/app-logo.png" alt="App Logo">
        </span>
        <span class="brand-name" id="header-name">mStore</span>
      </div>
      <div class="header-search-input-container">
        <input type="text" class="header-search-input" id="header-search-input" placeholder="Search anything..." autocomplete="off">
        <i class="fas fa-times search-clear" id="search-clear"></i>
      </div>
      <div class="header-actions">
        <div class="header-icon connection-indicator" id="connection-indicator" title="Connection Status">
          <i class="fas fa-wifi"></i>
        </div>
        <!-- Settings Icon (moved after connection indicator) -->
        <div class="header-icon hidden" id="settings-icon" title="Settings">
          <i class="fas fa-cog"></i>
        </div>
        <div class="header-icon" id="search-toggle">
          <i class="fas fa-search"></i>
        </div>
        <div class="header-icon" id="notification-icon">
          <i class="fas fa-bell"></i>
          <span class="notification-badge hidden">3</span>
        </div>
      </div>
      <!-- Search Suggestions Box: Moved INSIDE the header content for correct positioning. -->
      <ul id="search-suggestions" class="search-suggestions"></ul>
      </nav>